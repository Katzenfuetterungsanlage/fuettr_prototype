{"version":3,"sources":["main.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import * as express from 'express';\r\nimport * as path from 'path';\r\nimport * as bodyparser from 'body-parser';\r\n\r\nimport * as http from 'http';\r\nimport * as fs from 'fs';\r\n\r\n\r\n\r\nprocess.env['DEBUG'] = '*';\r\nprocess.env['DEBUG_COLORS'] = \"true\";\r\nprocess.env['DEBUG_STREAM'] = \"stdout\";\r\nimport * as debugsx from 'debug-sx';\r\nconst debug: debugsx.IFullLogger = debugsx.createFullLogger('main');\r\nlet consolelogger: debugsx.IHandler = debugsx.createConsoleHandler('stdout', \"*\");\r\nlet date = new Date();\r\nlet filelogger: debugsx.IHandler = debugsx.createFileHandler(\r\n  'logs/' + date.getFullYear() + '-' + date.getUTCMonth() + '-' + date.getUTCDay() + '_' + date.getUTCHours() + '-' + date.getUTCMinutes() + '-' + date.getUTCSeconds() + '.log', );\r\n\r\ndebugsx.addHandler(consolelogger, filelogger);\r\n\r\nconst serverApp = express();\r\nserverApp.use(bodyparser.json());\r\nserverApp.set('views', path.join(__dirname, '/views'));\r\nconst pugEngine = serverApp.set('view engine', 'pug');\r\npugEngine.locals.pretty = true;\r\n\r\nserverApp.use(logger);\r\nserverApp.use('/node_modules', express.static(path.join(__dirname, '../node_modules')));\r\nserverApp.get('/put', (req, res) => { res.sendFile(path.join(__dirname, '../src/views/put.html')); });\r\nserverApp.get('/api/callMeMaybe', callMeMaybe);\r\nserverApp.post('/api/putMeHere', putMeHere);\r\nserverApp.get('**', (req, res) => { res.redirect('/api/callMeMaybe') });\r\nserverApp.use(error404Handler);\r\nserverApp.use(errorHandler);\r\n\r\nconst port = 80;\r\nconst server = http.createServer(serverApp).listen(port);\r\ndebug.info('Server running on port ' + port);\r\n\r\n\r\n\r\nfunction error404Handler(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  const clientSocket = req.socket.remoteAddress + ':' + req.socket.remotePort;\r\n  debug.warn('Error 404 for %s %s from %s', req.method, req.url, clientSocket);\r\n  res.status(404).sendFile(path.join(__dirname, '../src/views/error404.html'));\r\n}\r\n\r\n\r\nfunction errorHandler(err: express.Errback, req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  const ts = new Date().toLocaleString();\r\n  debug.severe('Error %s\\n%e', ts, err);\r\n  res.status(500).render('error500.pug',\r\n    {\r\n      time: ts,\r\n      href: 'mailto:greflm13@htl-kaindorf.ac.at?subject=FÃ¼ttr server failed ' + ts,\r\n      serveradmin: 'Florian Greistorfer',\r\n    });\r\n}\r\n\r\n\r\nfunction getToJava(path: string, data: string) {\r\n  console.log('Data: ' + data);\r\n  const options = {\r\n    host: 'localhost',\r\n    port: 666,\r\n    path: path,\r\n    method: 'PUT'\r\n  };\r\n\r\n  const req = http.request(options, function (res) { res.on('data', function () { }); });\r\n\r\n  req.on('error', function (err) {\r\n    debug.severe(err);\r\n  });\r\n\r\n  req.write(data);\r\n  req.end();\r\n}\r\n\r\n\r\nfunction putMeHere(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  switch (req.query.q) {\r\n    case 'times': {\r\n      getToJava('/putTimes', '{\"time1\":\"11:11\",\"time2\":\"12:12\",\"time3\":\"13:13\",\"time4\":\"\",\"time1_active\":true,\"time2_active\":true,\"time3_active\":true,\"time4_active\":false}');\r\n      break;\r\n    }\r\n\r\n    case 'ackErr': {\r\n      getToJava('/ackErr', '{\"id\":12}');\r\n      break;\r\n    }\r\n\r\n    case 'ackWarn': {\r\n      getToJava('/ackWarn', '{\"id\":13}');\r\n      break;\r\n    }\r\n\r\n    default: { error404Handler(req, res, next); }\r\n  }\r\n}\r\n\r\n\r\nfunction getFromJava(res: express.Response, path: string) {\r\n  http.get({ port: 666, host: 'localhost', path: '/' + path }, (resp) => {\r\n    let data = '';\r\n\r\n    resp.on('data', (chunk) => {\r\n      data += chunk;\r\n    });\r\n\r\n    resp.on('end', () => {\r\n      try {\r\n        res.json(JSON.parse(data));\r\n      } catch (err) {\r\n        debug.severe(err);\r\n      }\r\n    });\r\n\r\n  }).on(\"error\", (err) => {\r\n    debug.severe(err);\r\n  });\r\n}\r\n\r\n\r\nfunction callMeMaybe(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  switch (req.query.q) {\r\n    case 'warnings': {\r\n      getFromJava(res, 'warnings');\r\n      break;\r\n    }\r\n\r\n    case 'errors': {\r\n      getFromJava(res, 'errors');\r\n      break;\r\n    }\r\n\r\n    case 'times': {\r\n      getFromJava(res, 'times');\r\n      break;\r\n    }\r\n\r\n    case 'status': {\r\n      getFromJava(res, 'status');\r\n      break;\r\n    }\r\n\r\n    case 'info': {\r\n      getFromJava(res, 'info');\r\n      break;\r\n    }\r\n\r\n    case 'positions': {\r\n      getFromJava(res, 'positions');\r\n      break;\r\n    }\r\n\r\n    default: { error404Handler(req, res, next); }\r\n  }\r\n}\r\n\r\nfunction logger(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  const clientSocket = req.socket.remoteAddress + ':' + req.socket.remotePort;\r\n  debug.info(req.method, req.url, clientSocket);\r\n  next();\r\n}"],"sourceRoot":"Z:\\Git\\fuettr_prototype\\Web_Application\\TestserverFuerJava"}